<ion-view title="{{name}}" hide-tabsxietong>
    
    <!-- 消息主体 -->
    <ion-content class="rj-stable-content" delegate-handle="messageDetailsScroll" 
    id="message-detail-content" ng-class="{'message-detail-height': showPhonebar}" style="background-color:#eee">
        <ion-refresher pulling-text="加载中..." on-refresh="doRefresh()" pulling-icon=""></ion-refresher>
        <ol id="lstMessage">
            <li ng-repeat="message in hisMsgs track by $index" id="msg_{{message.messageId}}" data-messageid="{{message.messageId}}">
                <div ng-include src="buildUrl(message.objectName)"></div>
            </li>
        </ol>
    </ion-content>

    <!-- 麦克风图标(TODO:根据声音大小调节) -->
    <div class="microphone" ng-class="{'active':isStartRecord}">
        <img ng-src="{{voiceImg.url}}" ng-show="!recordWait">
        <ion-spinner icon="spiral" ng-show="recordWait"></ion-spinner>
    </div>

    <ion-footer-bar align-title="left" class="bar-light" resize-foot-bar 
    style="flex-direction:column" ng-class="{'message-footer-height':showPhonebar}">
        <section style="height:44px;display:flex;display:relative" ng-class="{'message-bar-height':showPhonebar}">
            <!-- 切换输入方式(键盘vs音频) -->
            <div class="rj-footer-btn-wrap">
                <span class="voice" ng-click="switchInputMethod($event)">
                    <i class="ic" ng-class="{'ic-voice': !isVoiceMethod, 'ic-keyboard-grey': isVoiceMethod}"></i>
                 </span>
            </div>
            
            <label class="item item-input rj-footer-input">
                <!-- 按住说话 -->
                <span class="hold-tips"
                    on-touch="onVoiceHold()"
                    on-release="onVoiceRelease()"
                    ng-class="{'active': isStartRecord}"
                    ng-show="isVoiceMethod">按住我说话
                </span>
                <!-- 文本输入框 -->
                <textarea msd-elastic id="text_content" ng-model="send_content"  ng-show="!isVoiceMethod"></textarea>
                <!-- 表情按钮 -->
                <div class="buttons">
                    <button class="rj-footer-btn button button-icon icon ion-happy-outline" ng-show="!isVoiceMethod" ></button>
                </div>
            </label>
            
            <div class="rj-footer-btn-wrap">
                <!-- 显示工具栏按钮+ -->
                <div class="buttons" ng-show="!send_content || send_content === ''">
                    <button class="button button-icon icon ion-ios-plus-outline rj-footer-btn-left" ng-click="onShowPhonebar()">
                </button>
                </div>
                <!-- 发送按钮 -->
                <div class="rj-send-button" ng-hide="!send_content || send_content === ''" ng-click="onSendTextMessage()">
                    <p>发送</p>
                </div>
            </div>
        </section>

        <!-- 工具栏 -->
        <div ng-show="showPhonebar" class="chat-toolbar">
            <div style="flex: 1;text-align: center;background: #fff; " ng-show="conversationType==='PRIVATE'">
                <img src="img/icon/vediochat.png" style="width:45px;border-radius: 50%" ng-click="onVoiceCall()">
                 <div>视频</div>
            </div>
            <div style="flex: 1;text-align: center;background: #fff; ">
                <img src="img/icon/camera.png" style="width:45px;border-radius: 50%" ng-click="takePic(0)">
                 <div>拍照</div>
            </div>
            <div style="flex: 1;text-align: center;background: #fff; ">
                <img src="img/icon/photos.png" style="width:45px;border-radius: 50%" ng-click="takePic(1)">
                <div>图片</div>
            </div>
            <div style="flex: 1;text-align: center;background: #fff; ">
            </div>
        </div>
    </ion-footer-bar>
</ion-view>