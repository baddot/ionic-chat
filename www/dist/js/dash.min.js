/*
 * controller负责数据对接与权限控制
 */
angular.module('dash', ["dash.service"])
  .controller('DashCtrl', function ($scope) {
    // 构建消息UI模板
    $scope.buildTplUrl = function (type) {

      /** 业务类模板 */
      var tplUrl;
      switch (type) {
        case 'industry':
          tplUrl = 'industry';
          break;
        case 'medical':
          tplUrl = 'medical';
          break;
        case 'aircondition':
          tplUrl = 'aircondition';
          buildAircondition();
          break;
        default:
        // TODO：隐藏业务tab
      }
      return 'module/dash/business/' + tplUrl + '/' + tplUrl + '.html';
    };

    /**
     * 构建Aircondition业务
     */
    $scope.expanders = [
      {
        title: 'Click me to expand',
        text: 'Hi there folks, I am the content that was hidden but is now shown.'
      },
      {
        title: 'Click this',
        text: 'I am even better text than you have seen previously'
      },
      {
        title: 'Test',
        text: 'test'
      }];
    function buildAircondition() {

    }
    
    $scope.addNewUser = function () {
      alert('xx');
      console.log("测试添加用户...");
    };
    $scope.addNewGroup = function () {
      console.log("测试发起群聊...");
    };
    $scope.addGroupMember = function () {
      console.log("测试添加群成员...");
    };
  })

/**
 * dash.service
 * 权限管理，模块加载与初始化
 */

angular.module('dash.service', [])
    // 好友服务
    .factory('AddNewUserService', function () {
        return {};
    })
    .factory('AddNewGroupService', function () {
        return {};
    })
// 指令实现
var dash=angular.module('dash');
dash.directive('accordion', function() {
    return {
        restrict : 'EA',
        replace : true,
        transclude : true,
        template : '<div ng-transclude></div>',
        controller : function() {
            var expanders = [];
            this.gotOpened = function(selectedExpander) {
                angular.forEach(expanders, function(expander) {
                    if (selectedExpander != expander) {
                        expander.showMe = false;
                    }
                });
            }
            this.addExpander = function(expander) {
                expanders.push(expander);
            }
        }
    }
});

dash.directive('expander', function() {
    return {
        restrict : 'EA',
        replace : true,
        transclude : true,
        require : '^?accordion',
        scope : {
            title : '=expanderTitle'
        },
        template : '<div>'
                   + '<div class="title" ng-click="toggle()">{{title}}</div>'
                   + '<div class="body" ng-show="showMe" ng-transclude></div>'
                   + '</div>',
        link: function(scope, element, attrs, accordionController) {
            scope.showMe = false;
            accordionController.addExpander(scope);
            scope.toggle = function toggle() {
                scope.showMe = !scope.showMe;
                accordionController.gotOpened(scope);
            }
        }
    }
});
